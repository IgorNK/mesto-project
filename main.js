(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{d3:()=>J,EA:()=>x});var t={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-21",headers:{authorization:"aeccfdf1-17cb-4e9d-8818-d4f10c28a16b","Content-type":"application/json"}};function n(){return fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))}function o(e,t){return e.querySelector(".".concat(t.id,"-error"))}function r(e,t){t.validity.valid?function(e,t){var n=o(e,t);t.classList.remove("form__field_type_error"),n.textContent="",n.classList.remove("form__field-error_active")}(e,t):(t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),function(e,t,n){var r=o(e,t);t.classList.add("form__field_type_error"),r.textContent=n,r.classList.add("form__field-error_active")}(e,t,t.validationMessage))}function c(e,t){!function(e){return e.some((function(e){if(!e.validity.valid)return!0}))}(t)?function(e){e.disabled=!1,e.classList.remove("form__button_inactive")}(e):function(e){e.disabled=!0,e.classList.add("form__button_inactive")}(e)}function a(e){if(null!=e.fields){var t=Object.values(e.fields),n=e.submit,o=e.form;c(n,t),t.forEach((function(e){e.addEventListener("input",(function(){r(o,e),c(n,t)}))}))}}var i,u=document.querySelector(".popup__for_add-place"),l=document.querySelector(".popup__for_profile-edit"),s=document.querySelector(".popup__for_avatar-edit"),d=document.querySelector(".popup__for_delete-place"),f=document.forms["profile-edit"],p=document.forms["add-place"],m=document.forms["delete-place"],_=document.forms["avatar-edit"],v=f.elements.name,h=f.elements.description,b=_.elements.link,k=p.elements.title,E=p.elements.link,y=f.querySelector(".form__button"),L=p.querySelector(".form__button"),S=m.querySelector(".form__button"),C=_.querySelector(".form__button"),R={profileEdit:{form:f,popup:l,fields:{name:v,description:h},callback:function(e){var n=v.value,o=h.value;j(e),function(e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e,about:n})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))}(n,o).then((function(t){J(t),O(e,g)})).catch((function(e){console.log("EDIT PROFILE ERROR: ".concat(e))}))},submit:y},addPlace:{form:p,popup:u,fields:{title:k,link:E},callback:function(e){var n,o=k.value,r=E.value;j(e),(n={title:o,link:r},fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n.title,link:n.link})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(t){var n;n=t,I.prepend(w(n)),O(e,g)})).catch((function(e){return console.log("ADD PLACE ERROR: ".concat(e))}))},submit:L},deletePlace:{form:m,popup:d,place:null,callback:function(e){j(e);var n,o=e.place;(n=o._id,fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():(console.log("erroring now"),Promise.reject(e.status))}))).then((function(t){!function(e){e.placeElement.remove()}(o),O(e,P)})).catch((function(e){console.log("DELETE PLACE ERROR: ".concat(e))}))},submit:S},avatarEdit:{form:_,popup:s,fields:{link:b},callback:function(e){var n,o=b.value;j(e),(n=o,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(t){J(t),O(e)})).catch((function(e){console.log("EDIT AVATAR ERROR: ".concat(e))}))},submit:C}},q="Saving...",g="Сохранить",P="Да";function j(e){e.submit.textContent=q}function O(e,t){e.submit.textContent=t,T(e.popup),function(e){if(e.form.reset(),null!=e.fields){var t=Object.values(e.fields);c(e.submit,t)}}(e)}function U(e){e.classList.add("popup_opened"),function(e){document.addEventListener("keydown",i=function(t){"Escape"===t.key&&(document.activeElement.blur(),T(e))})}(e)}function T(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",i)}var x,A=[],D=document.querySelector("#card-template").content,I=document.querySelector(".cards");function w(e){var t=D.querySelector(".card").cloneNode(!0),n=t.querySelector(".card__name"),o=t.querySelector(".card__image"),r=t.querySelector(".card__like-button"),c=t.querySelector(".card__like-button-count"),a=t.querySelector(".card__delete-button");e.placeElement=t,e.likeButton=r,e.likeCount=c,n.textContent=e.name,o.src=e.link,o.alt=e.name,c.textContent=e.likes.length;var i=e.likes.reduce((function(e,t){return t._id==x._id}),!1);return e.currentLikeCallback=function(){},i?(r.classList.add("card__like-button_active"),e.currentLikeCallback=Q):(r.classList.remove("card__like-button_active"),e.currentLikeCallback=B),r.addEventListener("click",N),e.owner._id==x._id?a.addEventListener("click",(function(){!function(e){R.deletePlace.place=e,U(R.deletePlace.popup)}(e)})):a.classList.add("card__delete-button_hidden"),o.addEventListener("click",(function(){var t,n,o,r,c;t=e.link,n=e.name,r=(o=document.querySelector(".popup__for_image")).querySelector(".popup__image"),c=o.querySelector(".popup__image-caption"),r.src=t,r.alt=n,c.textContent=n,U(o)})),A.push(e),t}function N(e){var t=e.target,n=function(e,t){return e.find((function(e){return e.likeButton===t}))}(A,t);n.currentLikeCallback(n)}function B(e){var n;e.likeCount.textContent=parseInt(e.likeCount.textContent)+1,e.likeButton.classList.add("card__like-button_active"),e.currentLikeCallback=Q,(n=e._id,fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).catch((function(e){console.log("LIKE REQUEST ERROR: ".concat(e))}))}function Q(e){var n;e.likeCount.textContent=parseInt(e.likeCount.textContent)-1,e.likeButton.classList.remove("card__like-button_active"),e.currentLikeCallback=B,(n=e._id,fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).catch((function(e){console.log("UNLIKE REQUEST ERROR: ".concat(e))}))}function J(e){var t=document.querySelector(".profile__name"),n=document.querySelector(".profile__description"),o=document.querySelector(".profile__avatar-edit-button");t.textContent=e.name,n.textContent=e.about,o.style.backgroundImage="url(".concat(e.avatar,")");var c=R.profileEdit.form,a=R.profileEdit.fields.name,i=R.profileEdit.fields.description;a.value=e.name,i.value=e.about,r(c,a),r(c,i)}document.querySelector(".profile__avatar-edit-button").addEventListener("click",(function(){U(R.avatarEdit.popup)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){n(),U(R.profileEdit.popup)})),document.querySelector(".profile__add-button").addEventListener("click",(function(){U(R.addPlace.popup)})),document.addEventListener("click",(function(e){var t=e.target;t.classList.contains("popup")&&T(t)})),function(e){var t=function(t){e[t].form.addEventListener("submit",(function(n){n.preventDefault(),e[t].callback(e[t])}))};for(var n in e)t(n)}(R),document.querySelectorAll(".popup__close-button").forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){T(t)}))})),function(e){for(var t in e){var n=e[t];n.form.addEventListener("submit",(function(e){e.preventDefault()})),a(n)}}(R),n().then((function(e){J(e),x=e})).then((function(){fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){var t;t=e,Array.from(I.children).forEach((function(e){e.remove()})),t.forEach((function(e){var t;t=w(e),I.append(t)}))})).catch((function(e){return console.log("CARDS REQUEST ERROR: ".concat(e)),null}))})).catch((function(e){return console.log("PROFILE REQUEST ERROR: ".concat(e))}))})();